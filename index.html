<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Notes</title>
<style>
body { margin:0; font-family:"Segoe UI",sans-serif; background:#f5f5f5; }
.navbar { display:flex; justify-content:space-between; align-items:center; background:#2b5797; color:white; padding:10px 20px; }
.navbar h2 { margin:0; font-size:20px; }
.tools { display:flex; gap:8px; flex-wrap:wrap; }
button, select { background:white; color:#2b5797; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; font-weight:600; }
button:hover { background:#dce6f9; }
.container { display:flex; gap:15px; padding:20px; }
#notepad { flex:3; background:white; min-height:80vh; padding:20px; font-size:16px; line-height:1.6; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.2); overflow-y:auto; }
#canvas-container { flex:3; height:80vh; overflow:auto; display:none; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.2); background:white; position:relative; }
canvas { cursor:crosshair; background: repeating-linear-gradient(white, white 24px, #e0e0e0 25px); display:block; margin-bottom:10px; border-radius:5px; }
#ai-panel { flex:1; background:white; border-radius:10px; padding:15px; box-shadow:0 0 5px rgba(0,0,0,0.2); }
#ai-output { white-space:pre-wrap; margin-top:10px; border:1px solid #ccc; padding:10px; border-radius:5px; min-height:80px; max-height:80vh; overflow:auto; }
</style>
</head>
<body>
<div class="navbar">
<h2>Smart Notes</h2>
<div class="tools">
<button onclick="switchMode('typing')">Typing Mode</button>
<button onclick="switchMode('handwriting')">Handwriting Mode</button>
<select id="penColor" onchange="changePenColor()">
<option value="#000000">Black</option>
<option value="#ff0000">Red</option>
<option value="#007bff">Blue</option>
<option value="#00b050">Green</option>
</select>
<button onclick="addPage()">➕ New Page</button>
<button onclick="exportPDF()">📄 Export PDF</button>
</div>
</div>

<div class="container">
<div id="notepad" contenteditable="true"></div>
<div id="canvas-container"></div>
<div id="ai-panel">
<input id="question" placeholder="Ask Gemini..." style="width:100%;padding:8px;border-radius:5px;border:1px solid #ccc;" />
<button onclick="askGemini()" style="margin-top:5px;width:100%;">Ask</button>
<div id="ai-output"></div>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const GEMINI_API_KEY = "AIzaSyD_rNREcBL7zRipSNiWlFgzXnGxgIJxr9A";

const notepad = document.getElementById("notepad");
const canvasContainer = document.getElementById("canvas-container");
const aiOut = document.getElementById("ai-output");

let mode = "typing";
let penColor = "#000";
let currentCanvas = null;
let pages = [];

// Mode switching
function switchMode(selected){
    mode = selected;
    if(mode==="typing"){
        notepad.style.display="block";
        canvasContainer.style.display="none";
    } else {
        notepad.style.display="none";
        canvasContainer.style.display="block";
        if(pages.length===0) addPage();
        showPage(pages.length-1);
    }
}

// Handwriting canvas
function createCanvas(){
    const c = document.createElement("canvas");
    c.width = canvasContainer.clientWidth;
    c.height = canvasContainer.clientHeight;
    const ctx = c.getContext("2d");
    ctx.lineWidth=2;
    ctx.lineCap="round";
    ctx.strokeStyle = penColor;
    let drawing=false;

    c.onmousedown = e=>{drawing=true; ctx.beginPath(); ctx.moveTo(e.offsetX,e.offsetY);};
    c.onmouseup = ()=>drawing=false;
    c.onmousemove = e=>{if(!drawing) return; ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke();};
    return c;
}

function addPage(){
    const newC = createCanvas();
    pages.push(newC);
    showPage(pages.length-1);
}

function showPage(index){
    canvasContainer.innerHTML="";
    currentCanvas = pages[index];
    canvasContainer.appendChild(currentCanvas);
}

function changePenColor(){
    penColor = document.getElementById("penColor").value;
    if(currentCanvas) currentCanvas.getContext("2d").strokeStyle = penColor;
}

// Gemini AI
async function askGemini(){
    const question = document.getElementById("question").value.trim();
    if(!question) return;
    aiOut.textContent="Thinking...";
    try{
        const response = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`,
            {
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify({
                    prompt:[{ role:"user", content:[{ type:"text", text: question }] }],
                    temperature:0.7
                })
            }
        );
        const data = await response.json();
        const reply = 
            data?.candidates?.[0]?.content?.[0]?.text ||
            data?.candidates?.[0]?.content?.[0]?.parts?.[0]?.text ||
            data?.output?.[0]?.content?.[0]?.text ||
            data?.output?.[0]?.content?.[0]?.parts?.[0]?.text ||
            "⚠️ No valid response from Gemini.";
        aiOut.textContent = reply;
        if(mode==="typing") notepad.innerHTML+="\nAI: "+reply+"\n";
    }catch(err){
        console.error(err);
        aiOut.textContent="Error connecting to AI.";
    }
}

// PDF export
function exportPDF(){
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('p','pt','a4');

    if(mode==="typing"){
        const text = notepad.innerText;
        const lines = pdf.splitTextToSize(text,500);
        pdf.text(lines,40,40);
    } else {
        pages.forEach((c,index)=>{
            if(index>0) pdf.addPage();
            const img = c.toDataURL("image/png");
            pdf.addImage(img,"PNG",20,20,550,700);
        });
    }

    pdf.save("SmartNotes.pdf");
}

// Initialize default mode
switchMode("typing");
</script>
</body>
</html>
